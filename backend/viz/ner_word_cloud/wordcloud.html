<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NER Word Cloud</title>
  
  <!-- Load D3 and Word Cloud Layout -->
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://unpkg.com/d3-cloud/build/d3.layout.cloud.js"></script>
  
  <!-- Load seedrandom to fix the word layout -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>

  <!-- Load the word list from your preprocessed JS file -->
  <script src="words.js"></script>

  <style>
    body {
      font-family: sans-serif;
    }
  </style>
</head>
<body>

<script>
  // Fix the layout seed so the cloud is consistent on every load
  Math.seedrandom("ner-wordcloud");

  const width = 800;
  const height = 600;

  const layout = d3.layout.cloud()
    .size([width, height])
    .words(words) // 'words' is defined in words.js
    .padding(5)
    .rotate(() => 0)  // Fixed rotation for clarity
    .fontSize(d => d.size)
    .spiral("rectangular")  // More stable layout
    .on("end", draw);

  layout.start();

  function draw(words) {
    d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height)
    .append("g")
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
    .selectAll("text")
      .data(words)
    .enter().append("text")
      .style("font-size", d => d.size + "px")
      .style("fill", () => d3.schemeCategory10[Math.floor(Math.random() * 10)])
      .attr("text-anchor", "middle")
      .attr("transform", d => "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")")
      .text(d => d.text);
  }
</script>

</body>
</html>


<button onclick="downloadPNG()">Download Word Cloud as PNG</button>

<script>
  function downloadPNG() {
    const svg = document.querySelector("svg");
    const svgData = new XMLSerializer().serializeToString(svg);
    const canvas = document.createElement("canvas");
    canvas.width = svg.width.baseVal.value;
    canvas.height = svg.height.baseVal.value;
    const ctx = canvas.getContext("2d");

    const img = new Image();
    img.onload = function () {
      ctx.drawImage(img, 0, 0);
      const link = document.createElement("a");
      link.download = "wordcloud.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    };
    img.src = "data:image/svg+xml;base64," + btoa(unescape(encodeURIComponent(svgData)));
  }
</script>
